<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h4 class="modal-title" id="myModalLabel">新建share</h4>
</div>
<div class="modal-body">
    <form class="form-horizontal" id="form-share" role="form" method="post" action="/addshare/">
        {% csrf_token %}
        <div class="form-group">
            <label for="problem" class="col-sm-2 control-label">问题</label>
            <div class="col-sm-9">
                <textarea name="problem" class="form-control" id="problem" placeholder="问题描述，异常信息等" required></textarea>
            </div>
        </div>

        <div class="form-group">
            <label for="reason" class="col-sm-2 control-label">原因</label>
            <div class="col-sm-9">
                <textarea name="reason" class="form-control" id="reason" placeholder="问题出现原因"></textarea>
            </div>
        </div>

        <div class="form-group">
            <label for="resolve" class="col-sm-2 control-label">解决方法</label>
            <div class="col-sm-9">
                <textarea name="resolve" class="form-control" id="resolve" placeholder="具体解决办法" required></textarea>
            </div>
        </div>

        <div class="form-group">
            <label for="keywords" class="col-sm-2 control-label">关键字</label>
            <div class="col-sm-9">
                <textarea name="keywords" class="form-control" id="keywords" placeholder="关键字，异常信息等，有助于被搜索到" required></textarea>
            </div>
        </div>

        <div class="form-group">
            <label for="category" class="col-sm-2 control-label">分类</label>
            <div class="col-sm-9">
                <select name="category" class="form-control" id="category">
                    {% for c in category %}
                        <option value="{{ c.id }}">{{ c.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <button type="submit" hidden="hidden" id="btn-submit-form"></button>
    </form>

</div>
<div class="modal-footer">
    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
    <button type="button" class="btn btn-primary" id="btn-submit">提交</button>
</div>
<script>

    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    var csrftoken = getCookie('csrftoken');

    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

    $.ajaxSetup({
        crossDomain: false, // obviates need for sameOrigin test
        beforeSend: function (xhr, settings) {
            if (!csrfSafeMethod(settings.type)) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });

    $("#btn-submit").bind("click", function () {
        var form = new FormData($("#form-share")[0]);
        $.ajax({
            url: '/addshare/',
            type: 'post',
            data: form,
            processData: false,
            contentType : false,
            success:function(r){
                alert(r);
                window.location.href = "/index/";
            }
        });
    })
</script>